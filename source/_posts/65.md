---
title: gdb自查手册
date: 2018-05-15 09:41:39
categories: 安全
tags:
- 安全
- 工具
---

### 加载被调试的可执行文件
```
file <文件名> 
```

### 开始调试命令
进入调试环境以后，输入 start 命令开始调试。start 命令用于拉起被调试程序，并执行至 main 函数的开始位置，程序被执行之后与一个用户态的调用栈关联。
```
start
```

### 运行被调试程序
如果此前没有下过断点，则执行完整个程序；如果有断点，则程序暂停在下一个可用断点处。
```
run
r
```

### 继续执行被调试程序
继续执行被调试程序，直至下一个断点或程序结束。
```
continue
c
```

### 设置断点
设置断点，可以使用**行号**、**函数名称**、**执行地址**等方式指定断点位置。在函数名称前面加 **\*** 符号表示将断点设置在由编译器生成的 **prolog** 代码处。**prolog**、**epilog** 分别表示编译器在每个函数的开头和结尾自行插入的代码。
```
break <行号>
break <函数名称>
break *<函数名称>
break <代码地址>

b <行号>
b <函数名称>
b *<函数名称>
b <代码地址>
```

### 打印断点信息
打印程序中设置的所有断点信息。
```
info break
```

### 删除断点
不加编号代表删除所有断点。
```
delete [断点编号]
```

### 开启断点、暂停断点
```
enable [断点编号]
disable [断点编号]
```

### 源代码层级，单步执行，进入函数
执行一行源代码（注意是源代码层级的），遇到函数就进入该函数并且继续单步执行，这个命令必须在有源代码调试信息的情况下才可以使用（GCC编译时使用“-g”参数）。
```
step
s
```

### 源代码层级，单步执行，不进入函数
执行一行源代码（注意是源代码层级的），遇到函数不会进入函数，而是将整个函数执行看成一步，这个命令必须在有源代码调试信息的情况下才可以使用（GCC编译时使用“-g”参数）。
```
next
n
next 3  # 执行三行源代码
n 3  # 执行三行源代码
```

### 汇编指令层级，单步执行，进入函数
```
si
si 3  # 执行三行汇编代码
```

### 汇编指令层级，单步执行，不进入子函数
```
ni
ni 3  # 执行三行汇编代码
```

### 显示当前函数的汇编信息
我们可以用 disassemble 命令显示当前函数的汇编信息。同时可以指定 -r 参数和 -m 参数。-m 参数是指定显示的计算机指令用 16 进制表示。/m 参数指定显示汇编指令的同时，显示相应的源代码。
```
disassemble
disassemble /r
disassemble /m
disassemble /rm
```

### 打印变量信息
显示指定变量（临时变量或全局变量）的值。
```
print <变量名>
p <变量名>
```

### 分割窗口
```
layout src  # 显示源代码窗口
layout asm  # 显示反汇编窗口
layout regs  # 增加寄存器窗口
layout split  # 显示源代码和反汇编窗口
ctrl + l  # 刷新窗口
refresh  # 刷新窗口
focus cmd  # 聚焦到 cmd 窗口
focus asm  # 聚焦到 asm 窗口
focus src  # 聚焦到 src 窗口
focus regs  # 聚焦到 regs 窗口
tui reg next  # 显示下一组寄存器
tui reg prev  # 显示上一组寄存器
```

### 帮助命令
如果指定了“命令名称”参数，则显示该命令的详细说明；如果没有指定参数，则分类显示所有 gdb 命令，供用户进一步浏览和查询。
```
help [命令参数]
```

### 输出信息
```
f 0  # 打印第 0 个栈帧的基本信息
frame 0  # 打印第 0 个栈帧的基本信息
info frame 0  # 打印第 0 个栈帧的详细信息
i f 0  # 打印第 0 个栈帧的详细信息
info stack  # 查看堆栈使用信息
info reg  # 查看寄存器信息
info args # 查看当前程序栈的参数
i r
i all-r
info locals  # 打印当前程序栈的局部变量
```

### 打印栈帧指针
```
bt
backtrace
```

### 查看内存
命令格式为 x/[n][f][u] <addr>，各个参数的含义为：
1. n：是一个正整数，表示需要显示的内存单元的个数。也就是说从当前地址向后显示几个内存单元的内容（从低地址向高地址）。
2. f：指定显示格式，常用的有以下几种
（1）x：按 16 进制格式显示变量
（2）a: 按 16 进制格式显示变量（不同于 x 参数）
3. u：指定每个单元的大小
（1）w：每个单元 4 个字节
（2）g：每个单元 8 个字节

```
x/20 $sp
x/20x $sp
x/20a $sp
x/20xw $sp
x/20aw $sp
x/20xg $sp
x/20ag $sp
x/x $pc
//组合方式很多，也很方便
```

### 查看内存映射
```
i proc mapping
```

### 退出
```
Quit
q
```

